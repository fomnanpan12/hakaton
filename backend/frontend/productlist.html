<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>My Products</title>
  <link rel="stylesheet" href="css/styles.css" />
  <link rel="stylesheet" href="css/admin.css">
</head>
<body>

 <header class="navbar">
   <div class="container nav-content">
    <!-- Logo -->
    <div class="logo" onclick="window.location.href='/'">Track2Chain</div>

    <!-- Navigation Links -->
    <nav class="nav-center">
      <ul class="nav-links">
        <li><a href="/">Home</a></li>
        <li><a href="/scan.html">Scan</a></li>
        <li><a href="/about.html">About</a></li>
        <li><a href="productview.html">Add Products</a></li>
        <li><a href="productlist.html" class="active">My Products</a></li>
      </ul>
    </nav>

    <!-- Buttons -->
    <div class="auth-buttons">
     <a href="auth.html" 
     onclick="logout()" 
     style="background: linear-gradient(135deg, #9D6753 0%, #b7836d 100%); 
            color: white; 
            padding: 8px 14px; 
            border-radius: 6px; 
            text-decoration: none; 
            font-weight: 700; 
            border: 2px solid transparent; 
            transition: 0.3s ease;">
        Logout
    </a>
    </div>

    <!-- Hamburger for Mobile -->
    <button class="hamburger" id="navToggle" aria-label="Toggle menu" aria-expanded="false">
      <span class="bar"></span>
      <span class="bar"></span>
      <span class="bar"></span>
    </button>
   </div>
  </header>

    <style>
    /* Table Styling */
    table {
      width: 90%;
      margin: 40px auto;
      border-collapse: separate;
      border-spacing: 0;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      overflow: hidden;
    }

    thead {
      background: linear-gradient(135deg, #9D6753, #b7836d);
      color: white;
    }

    thead th {
      padding: 16px;
      text-align: left;
      font-size: 15px;
      font-weight: 600;
    }

    tbody td {
      padding: 14px 16px;
      border-bottom: 1px solid #f0f0f0;
      font-size: 14px;
      color: #333;
    }

    tbody tr:last-child td {
      border-bottom: none;
    }

    tbody tr:hover {
      background: #f9f9f9;
      transition: 0.2s ease;
    }

    /* Buttons inside table */
    tbody button {
      background: linear-gradient(135deg, #9D6753, #b7836d);
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-right: 6px;
    }

    tbody button:hover {
      opacity: 0.9;
      transform: translateY(-2px);
    }

    /* Modal Styling */
    #qrModal {
      display: none;
      position: fixed;
      top: 0; left: 0; 
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    #qrModal img {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      max-width: 90%;
      max-height: 90%;
      box-shadow: 0 8px 25px rgba(0,0,0,0.2);
      animation: zoomIn 0.3s ease;
    }

    @keyframes zoomIn {
      from { transform: scale(0.7); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    /* Page Heading */
    h1 {
      text-align: center;
      margin: 40px 0 20px;
      font-size: 28px;
      color: #333;
    }
  </style>


  <h1 style="text-align:center; margin:30px 0 20px; font-size:28px; color:#000; font-weight:700;">
    My Products
  </h1>

  <table style="
    width:90%;
    margin:0 auto 40px auto;
    border-collapse:separate;
    border-spacing:0;
    background:#fff;
    border-radius:12px;
    box-shadow:0 4px 20px rgba(0,0,0,0.1);
    overflow:hidden;
    font-family:sans-serif;
    color:#000;
  ">
    <thead style="background:linear-gradient(135deg,#9D6753,#b7836d); color:#fff;">
      <tr>
        <th style="padding:16px; text-align:left; font-size:15px; color:#000; font-weight:600;">Product Name</th>
        <th style="padding:16px; text-align:left; font-size:15px; color:#000; font-weight:600;">Product ID</th>
        <th style="padding:16px; text-align:left; font-size:15px; color:#000; font-weight:600;">Transaction Hash</th>
        <th style="padding:16px; text-align:left; font-size:15px; color:#000; font-weight:600;">Actions</th>
      </tr>
    </thead>
    <tbody id="productTableBody" style="font-size:14px;"></tbody>
  </table>


  <!-- Modal for QR preview -->
  <div id="qrModal" onclick="closeModal()">
    <img id="qrPreview" src="" alt="QR Code Preview">
  </div>

  <script>
    const API = "https://hakaton-1lu4.onrender.com";

    async function fetchProducts() {
      const token = localStorage.getItem("token");
      if (!token) {
        alert("Please login first.");
        return;
      }

      const res = await fetch(API + "/products/my", {
        headers: { Authorization: "Bearer " + token }
      });

      const data = await res.json();
      const tbody = document.getElementById("productTableBody");
      tbody.innerHTML = "";

      if (!Array.isArray(data) || data.length === 0) {
        tbody.innerHTML = "<tr><td colspan='4' style='text-align:center; padding:20px;'>No products found.</td></tr>";
        return;
      }

      data.forEach(p => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${p.name}</td>
          <td>${p.productId}</td>
          <td>${p.txHash}</td>
          <td>
            <button onclick="showQR('${p.qrCode}')">View QR</button>
            <button onclick="viewDetails('${p.productId}')">View Details</button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    function showQR(qrCode) {
      const modal = document.getElementById("qrModal");
      const img = document.getElementById("qrPreview");
      img.src = qrCode;
      modal.style.display = "flex";
    }

    function closeModal() {
      document.getElementById("qrModal").style.display = "none";
    }

    function viewDetails(productId) {
      window.location.href = `/product.html?id=${productId}`;
    }

    // Load products on page load
    fetchProducts();
  </script>

</body>
</html>
